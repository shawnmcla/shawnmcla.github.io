"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var miniVU=function(){function a(b){var c=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,a),this.VERSION="beta 1.0",this.TITLE_PLACEHOLDER="{{miniVU title}}",this.DEFAULT_NOT_FOUND="<h1>404 not found</h1>",this.ERROR_MSGS={GENERIC_HELP:"For more help and documentation, see https://github.com/shawnmcla/miniVU",INVALID_SELECTOR:"The targetElementSelector parameter must be a non-empty string selector. (e.g. #idSelector, .classSelector)",ELEMENT_NOT_FOUND:"The targetElementSelector passed cannot be found in the DOM.",VIEW_NOT_FOUND:"The associated HTML document for the view specified could not be found. Check that the file exists and is in the correct directory.",NO_DEFAULT_VIEW:"No default view was specified. Specifying a default view is strongly recommended. To specify a default view, pass the view name as the second argument when instantiating miniVU."},this.CONFIG={viewsDir:"./views",changeTitle:!1,titlePattern:"{{miniVU title}}",customNotFound:null,customTitles:null},this.ready=!1,this.currentView=null,this.targetArea=null,this.defaultView=d,0!==Object.keys(e).length&&this.loadConfig(e);var f;null!==b&&_typeof(b==String)?("."===b[0]?f=document.getElementsByClassName(b.substr(1))[0]:"#"===b[0]?f=document.getElementById(b.substr(1)):this.errorInvalidSelector(),f?(this.targetArea=f,this.ready=!0):this.errorTargetNotFound()):this.errorInvalidSelector(),window.addEventListener("hashchange",function(a){return c.handleHashChange(a,location.hash)}),window.addEventListener("popstate",function(a){a.state&&a.state.isView&&c.go(a.state.viewName)}),this.ready&&this.onLoad()}return _createClass(a,[{key:"loadConfig",value:function loadConfig(a){var b=this;Object.keys(a).forEach(function(c){b.CONFIG.hasOwnProperty(c)?(b.CONFIG[c]=a[c],console.info("Set config "+c+" to "+a[c])):console.error("Invalid config key: "+c+". Ignoring.")})}},{key:"pushState",value:function pushState(a){history.replaceState({isView:!0,viewName:a},null,"#/"+a)}},{key:"handleHashChange",value:function handleHashChange(a,b){if(a.preventDefault(),this.isMiniVUHash(b)){var c=b.substr(2);""===c?this.loadDefaultView():(this.go(c),this.pushState(c))}}},{key:"loadDefaultView",value:function loadDefaultView(){null===this.defaultView?console.info(ERROR_MSGS.NO_DEFAULT_VIEW):this.go(this.defaultView)}},{key:"onLoad",value:function onLoad(){console.log("Intialized miniVU version "+this.VERSION);var a=location.hash;if(""!==a&&this.isMiniVUHash(a)){var b=a.substr(2);""===b?this.loadDefaultView():this.go(b)}}},{key:"isMiniVUHash",value:function isMiniVUHash(a){return a&&"#/"==a.substr(0,2)}},{key:"loadHTMLContent",value:function loadHTMLContent(a){var b=this;return new Promise(function(c,d){var e=new XMLHttpRequest;e.onload=function(){4===e.readyState&&(200===e.status?c(e.response):d(e.statusText))},e.onerror=function(){d(e.statusText)},e.open("GET",b.CONFIG.viewsDir+"/"+a,!0),e.responseType="document",e.send()})}},{key:"clearContent",value:function clearContent(){for(;this.targetArea.hasChildNodes();)this.targetArea.removeChild(this.targetArea.lastChild)}},{key:"appendContent",value:function appendContent(a){var b=this;a.forEach(function(a){return b.targetArea.appendChild(a)})}},{key:"appendRaw",value:function appendRaw(a){this.targetArea.innerHTML=a}},{key:"stripContent",value:function stripContent(a){return a.body.childNodes}},{key:"swapContent",value:function swapContent(a,b){var c=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(this.clearContent(),c?this.appendRaw(b):this.appendContent(this.stripContent(b)),this.currentView=a,this.CONFIG.changeTitle){var d=a;this.CONFIG.customTitles&&this.CONFIG.customTitles.hasOwnProperty(a)&&(d=this.CONFIG.customTitles[a]),document.title=this.CONFIG.titlePattern.replace(this.TITLE_PLACEHOLDER,d)}}},{key:"go",value:function go(a){var b=this;a!==this.currentView&&this.loadHTMLContent(a+".html").then(function(c){return b.swapContent(a,c)}).catch(function(c){return b.errorViewNotfound(a,c)})}},{key:"errorInvalidSelector",value:function errorInvalidSelector(){console.error(this.ERROR_MSGS.INVALID_SELECTOR)}},{key:"errorTargetNotFound",value:function errorTargetNotFound(){console.error(this.ERROR_MSGS.ELEMENT_NOT_FOUND)}},{key:"errorViewNotfound",value:function errorViewNotfound(a,b){console.error(this.ERROR_MSGS.VIEW_NOT_FOUND+" File name: "+a+", Views directory: "+this.CONFIG.viewsDir,b),this.CONFIG.customNotFound?this.go(this.CONFIG.customNotFound):this.swapContent("404",this.DEFAULT_NOT_FOUND,!0)}}]),a}();
